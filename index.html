API_URL<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reply Helper</title>
  <meta name="description" content="Paste a message, choose a tone, and get 3 ready-to-send replies." />
  <style>
    :root { color-scheme: light; }
    body { font-family: Arial, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; background: #f6f7f9; }
    .wrap { max-width: 900px; margin: 0 auto; padding: 24px; }
    .card { background: white; border-radius: 14px; padding: 18px; box-shadow: 0 8px 24px rgba(0,0,0,.06); }
    h1 { margin: 0 0 8px; font-size: 22px; }
    p  { margin: 0 0 16px; color: #444; }
    label { display:block; font-weight: 600; margin: 14px 0 8px; }
    textarea { width: 100%; min-height: 160px; resize: vertical; padding: 12px; border-radius: 10px; border: 1px solid #d8dde6; font-size: 14px; }
    select { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #d8dde6; background: white; font-size: 14px; }
    .row { display: grid; grid-template-columns: 1fr; gap: 12px; margin-top: 12px; }
    .actions { display:flex; gap: 10px; align-items:center; margin-top: 14px; }
    button { padding: 10px 14px; border-radius: 10px; border: 0; cursor: pointer; font-weight: 700; }
    button.primary { background: #111827; color: white; }
    button.secondary { background: #eef2ff; color: #1f2a5a; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .hint { font-size: 12px; color:#666; margin-top: 8px; }
    .status { margin-top: 12px; font-size: 13px; }
    .status.err { color: #b42318; }
    .status.ok  { color: #067647; }
    .answers { margin-top: 18px; display: grid; gap: 12px; }
    .answer { border: 1px solid #e5e7eb; border-radius: 12px; padding: 12px; background: #fff; }
    .answer h3 { margin: 0 0 8px; font-size: 14px; }
    .answer pre { margin: 0; white-space: pre-wrap; word-wrap: break-word; font-family: inherit; font-size: 14px; line-height: 1.35; }
    .copy { margin-top: 10px; }
    .footer { margin-top: 18px; color:#666; font-size: 12px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>Reply Helper</h1>
      <p>Paste a message, choose a tone, and get <b>3</b> ready-to-send reply suggestions.</p>

      <label for="msg">Incoming message</label>
      <textarea id="msg" placeholder="Paste the message here..."></textarea>

      <div class="row">
        <div>
          <label for="tone">Tone</label>
          <select id="tone">
            <option value="polite">Polite</option>
            <option value="professional" selected>Professional / Business</option>
            <option value="firm">Firm</option>
            <option value="friendly">Friendly</option>
            <option value="short">Short & Direct</option>
          </select>
          <div class="hint">Tip: for customer complaints, use “Professional” or “Polite”.</div>
        </div>
      </div>

      <div class="actions">
        <button class="primary" id="go">Generate replies</button>
        <button class="secondary" id="clear">Clear</button>
        <span id="loading" class="hint" style="display:none;">Generating…</span>
      </div>

      <div id="status" class="status"></div>
      <div id="answers" class="answers" style="display:none;"></div>

      <div class="footer">
        Note: this page calls a secure backend proxy (no API keys in the browser).
      </div>
    </div>
  </div>

  <script>
    // IMPORTANT: replace this with your own backend/proxy endpoint
   const API_URL = "https://sparkling-wildflower-5f7e.typingspeedhub.workers.dev/generate";

    const $ = (id) => document.getElementById(id);

    const msgEl = $("msg");
    const toneEl = $("tone");
    const goBtn = $("go");
    const clearBtn = $("clear");
    const loadingEl = $("loading");
    const statusEl = $("status");
    const answersEl = $("answers");

    function setStatus(text, kind = "") {
      statusEl.textContent = text || "";
      statusEl.className = "status " + (kind || "");
    }

    function setLoading(isLoading) {
      loadingEl.style.display = isLoading ? "inline" : "none";
      goBtn.disabled = isLoading;
      clearBtn.disabled = isLoading;
    }

    function renderAnswers(list) {
      answersEl.innerHTML = "";
      list.forEach((text, idx) => {
        const div = document.createElement("div");
        div.className = "answer";
        div.innerHTML = `
          <h3>Reply #${idx + 1}</h3>
          <pre>${escapeHtml(text)}</pre>
          <div class="copy">
            <button class="secondary" data-copy="${idx}">Copy</button>
          </div>
        `;
        answersEl.appendChild(div);
      });

      answersEl.querySelectorAll("button[data-copy]").forEach(btn => {
        btn.addEventListener("click", async () => {
          const i = Number(btn.getAttribute("data-copy"));
          const text = list[i] || "";
          try {
            await navigator.clipboard.writeText(text);
            setStatus("Copied to clipboard ✅", "ok");
            setTimeout(() => setStatus(""), 1500);
          } catch {
            setStatus("Copy failed. Please select text and copy manually.", "err");
          }
        });
      });

      answersEl.style.display = "grid";
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    clearBtn.addEventListener("click", () => {
      msgEl.value = "";
      setStatus("");
      answersEl.style.display = "none";
      answersEl.innerHTML = "";
      msgEl.focus();
    });

    goBtn.addEventListener("click", async () => {
      const message = msgEl.value.trim();
      const tone = toneEl.value;

      if (!message) {
        setStatus("Please paste a message first.", "err");
        msgEl.focus();
        return;
      }

      if (API_URL.includes("YOUR_BACKEND_URL_HERE")) {
        setStatus("Please set your backend API_URL in the code.", "err");
        return;
      }

      setStatus("");
      setLoading(true);
      answersEl.style.display = "none";
      answersEl.innerHTML = "";

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message, tone }),
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok) {
          throw new Error(data?.error || `Request failed (HTTP ${res.status})`);
        }

        if (!Array.isArray(data?.replies) || data.replies.length === 0) {
          throw new Error("No replies returned from server.");
        }

        renderAnswers(data.replies.slice(0, 3));
        setStatus("Done ✅", "ok");
      } catch (err) {
        console.error(err);
        setStatus(err.message || "Unexpected error.", "err");
      } finally {
        setLoading(false);
      }
    });
  </script>
</body>
</html>
